---
title: "Other_CCA"
output:
  html_document:
    df_print: paged
date: "2023-03-21"
always_allow_html: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(lava)
library(matlab)
library(plyr)
library(ggplot2)
library(plotly)
library(RGCCA)
```

```{r}
X = read.table("E:/GitHub/SNGCCA/SNGCCA/RealData/Exp664.txt", header = F, sep = " ")
Y = read.table("E:/GitHub/SNGCCA/SNGCCA/RealData/Meth664.txt", header = F, sep = " ")
Z = read.table("E:/GitHub/SNGCCA/SNGCCA/RealData/miRNA664.txt", header = F, sep = " ")

X <- scale(X)
Y <- scale(Y)
Z <- scale(Z)
Data_real = list(X = t(X), Y = t(Y), Z = t(Z))
cv_s <- rgcca_cv(Data1, response = 3, ncomp = 1,
                   prediction_model = "glmnet", lambda = .001,
                   par_type = "sparsity",
                   par_value = c(.7, .2, 1),
                   metric = "RMSE",
                   n_cores = 2,
 )

result = rgcca(Data_real, method = "sgcca", tau = c(1,1,1), sparsity = cv_s$best_params, ncomp = rep(1,
length(Data_real)), scheme = "horst", init = "svd",
bias = TRUE, tol = .Machine$double.eps, verbose = FALSE)

u=result$a[[1]]
v=result$a[[2]]
w=result$a[[3]]
getwd()
write.csv(u,'SGCCA_u.csv')
write.csv(v,'SGCCA_v.csv')
write.csv(w,'SGCCA_w.csv')

cv_tau <- rgcca_cv(Data_real, response = 3, method = "rgcca",
                   par_type = "tau",
                   par_length = 5,
                   prediction_model = "glmnet", #caret::modelLookup()
                   metric = "RMSE",
                   k=3, n_run = 3,
                   verbose = TRUE)
result = rgcca(Data_real, method = "rgcca", tau = cv_tau$call$tau, scheme = 'horst')
u=result$a[[1]]
v=result$a[[2]]
w=result$a[[3]]
getwd()
write.csv(u,'RGCCA_u.csv')
write.csv(v,'RGCCA_v.csv')
write.csv(w,'RGCCA_w.csv')

```

### Simulation - RGCCA & SGCCA - Linear & Nonlinear
```{r}

simu_l <- function(n,p,v,r){

cor_matrix <- matrix(c(1, 0.7, 0.7,
                        0.7, 1, 0,
                        0.7, 0, 1), 
                     nrow = 3, 
                     ncol = 3, 
                     byrow = TRUE)
RGCCA_u1 <- array(NA, dim = c(r, p))
RGCCA_u2 <- array(NA, dim = c(r, p))
RGCCA_u3 <- array(NA, dim = c(r, p))
SGCCA_u1 <- array(NA, dim = c(r, p))
SGCCA_u2 <- array(NA, dim = c(r, p))
SGCCA_u3 <- array(NA, dim = c(r, p))

t_rgcca <- rep(0,r)
t_sgcca <- rep(0,r)
for( i in 1:100){
  if(i %% 10 == 0){print(i)}
  root <- paste0('E:/GitHub/SNGCCA/SNGCCA/Data/Linear/',n,'_',p,'_',v)
  X = read.csv(paste0(root,'/data1_',i-1,'.csv'),header = F)
  Y = read.csv(paste0(root,'/data2_',i-1,'.csv'),header = F)
  Z = read.csv(paste0(root,'/data3_',i-1,'.csv'),header = F)
  Data1 <- list(X,Y,Z)
  #if(i == 1){
    cv_tau <- rgcca_cv(Data1, response = 3, method = "rgcca",
                   par_type = "tau",
                   par_length = 5,
                   prediction_model = "glmnet", #caret::modelLookup()
                   metric = "RMSE",
                   k=3, n_run = 3,
                   verbose = TRUE)
    cv_s <- rgcca_cv(Data1, response = 3, ncomp = 1,
                   prediction_model = "glmnet", lambda = .001,
                   par_type = "sparsity",
                   par_value = c(.7, .2, 1),
                   metric = "RMSE",
                   n_cores = 2,
 )
  #}
  ts <- Sys.time()
  res1 = rgcca(Data1, method = "rgcca", tau = cv_tau$call$tau, scheme = 'horst')
  te <- Sys.time()
  RGCCA_u1[i,] = res1$a[[1]]
  RGCCA_u2[i,] = res1$a[[2]]
  RGCCA_u3[i,] = res1$a[[3]]
  t_rgcca[i] <- ts - te
  
  ts <- Sys.time()
  res2 = rgcca(Data1, connection = 1 - cor_matrix, tau = c(1,1,1), sparsity = cv_s$best_params, method = "sgcca")
  te <- Sys.time()
  t_sgcca[i] <- te-ts
  SGCCA_u1[i,] = res2$a[[1]]
  SGCCA_u2[i,] = res2$a[[2]]
  SGCCA_u3[i,] = res2$a[[3]]
  
}
write.csv(t_rgcca,paste0('E:/GitHub/SNGCCA/SNGCCA/Simulation/Linear/',n,'_',p,'_',v,"/rgcca_t.csv"), row.names = FALSE)
write.csv(t_sgcca,paste0('E:/GitHub/SNGCCA/SNGCCA/Simulation/Linear/',n,'_',p,'_',v,"/sgcca_t.csv"), row.names = FALSE)
write.csv(RGCCA_u1,paste0('E:/GitHub/SNGCCA/SNGCCA/Simulation/Linear/',n,'_',p,'_',v,"/rgcca_u1.csv"), row.names = FALSE)
write.csv(RGCCA_u2,paste0('E:/GitHub/SNGCCA/SNGCCA/Simulation/Linear/',n,'_',p,'_',v,"/rgcca_u2.csv"), row.names = FALSE)
write.csv(RGCCA_u3,paste0('E:/GitHub/SNGCCA/SNGCCA/Simulation/Linear/',n,'_',p,'_',v,"/rgcca_u3.csv"), row.names = FALSE)
write.csv(SGCCA_u1,paste0('E:/GitHub/SNGCCA/SNGCCA/Simulation/Linear/',n,'_',p,'_',v,"/sgcca_u1.csv"), row.names = FALSE)
write.csv(SGCCA_u2,paste0('E:/GitHub/SNGCCA/SNGCCA/Simulation/Linear/',n,'_',p,'_',v,"/sgcca_u2.csv"), row.names = FALSE)
write.csv(SGCCA_u3,paste0('E:/GitHub/SNGCCA/SNGCCA/Simulation/Linear/',n,'_',p,'_',v,"/sgcca_u3.csv"), row.names = FALSE)
}

simu_nl <- function(n,p,v,r){
#========================================================================
RGCCA_u1 <- array(NA, dim = c(r, p))
RGCCA_u2 <- array(NA, dim = c(r, p))
RGCCA_u3 <- array(NA, dim = c(r, p))
SGCCA_u1 <- array(NA, dim = c(r, p))
SGCCA_u2 <- array(NA, dim = c(r, p))
SGCCA_u3 <- array(NA, dim = c(r, p))
t_rgcca <- rep(0,r)
t_sgcca <- rep(0,r)

for( i in 1:100){
  if(i %% 10 == 0){print(i)}
  root <- paste0('E:/GitHub/SNGCCA/SNGCCA/Data/Nonlinear/',n,'_',p,'_',v)
  X = read.csv(paste0(root,'/data1_',i-1,'.csv'),header = F)
  Y = read.csv(paste0(root,'/data2_',i-1,'.csv'),header = F)
  Z = read.csv(paste0(root,'/data3_',i-1,'.csv'),header = F)
  Data1 <- list(X,Y,Z)
  #if(i == 1){
    cv_tau <- rgcca_cv(Data1, response = 3, method = "rgcca",
                   par_type = "tau",
                   par_length = 5,
                   prediction_model = "glmnet", #caret::modelLookup()
                   metric = "RMSE",
                   k=3, n_run = 3,
                   verbose = TRUE)
    cv_s <- rgcca_cv(Data1, response = 3, ncomp = 1,
                   prediction_model = "glmnet", lambda = .001,
                   par_type = "sparsity",
                   par_value = c(.7, .2, 1),
                   metric = "RMSE",
                   n_cores = 2,
 )
  #}
  ts <- Sys.time()
  res1 = rgcca(Data1, method = "rgcca", tau = cv_tau$call$tau, scheme = 'horst')
  te <- Sys.time()
  t_rgcca[i] <- ts - te
  RGCCA_u1[i,] = res1$a[[1]]
  RGCCA_u2[i,] = res1$a[[2]]
  RGCCA_u3[i,] = res1$a[[3]]

  
  ts <- Sys.time()
  res2 = rgcca(Data1, tau = c(1,1,1), sparsity = cv_s$best_params, method = "sgcca")
  te <- Sys.time()
  t_sgcca[i] <- ts - te
  SGCCA_u1[i,] = res2$a[[1]]
  SGCCA_u2[i,] = res2$a[[2]]
  SGCCA_u3[i,] = res2$a[[3]]
  
}
write.csv(t_rgcca,paste0('E:/GitHub/SNGCCA/SNGCCA/Simulation/Nonlinear/',n,'_',p,'_',v,"/rgcca_t.csv"), row.names = FALSE)
write.csv(t_sgcca,paste0('E:/GitHub/SNGCCA/SNGCCA/Simulation/Nonlinear/',n,'_',p,'_',v,"/sgcca_t.csv"), row.names = FALSE)
write.csv(RGCCA_u1,paste0('E:/GitHub/SNGCCA/SNGCCA/Simulation/Nonlinear/',n,'_',p,'_',v,"/rgcca_u1.csv"), row.names = FALSE)
write.csv(RGCCA_u2,paste0('E:/GitHub/SNGCCA/SNGCCA/Simulation/Nonlinear/',n,'_',p,'_',v,"/rgcca_u2.csv"), row.names = FALSE)
write.csv(RGCCA_u3,paste0('E:/GitHub/SNGCCA/SNGCCA/Simulation/Nonlinear/',n,'_',p,'_',v,"/rgcca_u3.csv"), row.names = FALSE)
write.csv(SGCCA_u1,paste0('E:/GitHub/SNGCCA/SNGCCA/Simulation/Nonlinear/',n,'_',p,'_',v,"/sgcca_u1.csv"), row.names = FALSE)
write.csv(SGCCA_u2,paste0('E:/GitHub/SNGCCA/SNGCCA/Simulation/Nonlinear/',n,'_',p,'_',v,"/sgcca_u2.csv"), row.names = FALSE)
write.csv(SGCCA_u3,paste0('E:/GitHub/SNGCCA/SNGCCA/Simulation/Nonlinear/',n,'_',p,'_',v,"/sgcca_u3.csv"), row.names = FALSE)
}

simu_l(100,30,5,100)
simu_l(100,50,5,100)
simu_l(100,150,5,100)
simu_l(100,100,5,100)
simu_l(100,200,5,100)
simu_l(200,100,5,100)
simu_l(400,100,5,100)
simu_l(100,100,10,100)
simu_l(100,100,20,100)

simu_nl(100,30,5,100)
simu_nl(100,50,5,100)
simu_nl(100,150,5,100)
simu_nl(100,100,5,100)
simu_nl(100,200,5,100)
simu_nl(200,100,5,100)
simu_nl(400,100,5,100)
simu_nl(100,100,10,100)
simu_nl(100,100,20,100)

```